# PWV数据集缺失情况与清洗过程分析报告

## 1. 原始数据概况

### 1.1 数据来源
- **数据文件**：`docs/excel/pwv数据采集表 -去公式.xlsx`
- **数据规模**：222行 × 77列
- **数据内容**：人民医院与小米可穿戴设备合作的动脉硬化筛查与脑卒中风险预测研究数据

### 1.2 数据结构
- **基础信息类**：年龄、性别、身高、体重等人口统计学特征
- **血管功能指标**：PWV（脉搏波传导速度）、cfPWV（颈股PWV）、baPWV（臂踝PWV）等
- **血流动力学参数**：收缩压、舒张压、ABI（踝臂指数）等
- **生化指标**：CRP、PCT、TnI、CK-MB、肌红蛋白、BNP等实验室检查结果

## 2. 缺失值详细分析

### 2.1 关键变量缺失情况
| 变量名 | 总记录数 | 非空记录数 | 缺失记录数 | 缺失率(%) |
|-------|---------|-----------|-----------|---------|
| 基础信息-年龄 | 222 | 222 | 0 | 0.00 |
| 受试者-性别 | 222 | 222 | 0 | 0.00 |
| 基础信息-身高 | 222 | 222 | 0 | 0.00 |
| 基础信息-体重 | 222 | 222 | 0 | 0.00 |
| 收缩压 | 222 | 222 | 0 | 0.00 |
| 舒张压 | 222 | 222 | 0 | 0.00 |
| 竞品信息-脉搏波传导速度(pwv) | 222 | 221 | 1 | 0.45 |
| cfPWV-速度m/s | 222 | 206 | 16 | 7.21 |
| baPWV-右侧-速度m/s | 222 | 213 | 9 | 4.05 |
| baPWV-左侧-速度m/s | 222 | 212 | 10 | 4.50 |

### 2.2 二级特征缺失情况
| 变量类型 | 变量示例 | 平均缺失率(%) | 说明 |
|---------|---------|--------------|------|
| 血流速度指标 | 血流速度-颈部-最高速度m/s | 约25% | 颈部指标缺失54-56个，腕部指标缺失约25个 |
| ABI相关指标 | ABI-右侧-肱血压 | 约5-8% | 不同部位ABI指标缺失11-18个不等 |
| 血管弹性参数 | cfPWV-颈动脉-SI | 约40% | SI和RI指标缺失约91-93个 |
| 血管搏动指数 | cfPWV-颈动脉-DAIX | 约40% | DAIX指标缺失量与SI/RI相近 |

### 2.3 实验室检查严重缺失情况
| 变量类型 | 变量数量 | 缺失记录数 | 缺失率(%) |
|---------|---------|-----------|---------|
| 生化指标 | 13 | 约131 | 59.01 |

**生化指标清单**：CRP、PCT、TnI、CK-MB、肌红蛋白、BNP、肌酐、WBC、RBC、Hb、PLT、PT、APTT、D-dimer

### 2.4 缺失模式分析
- **完全随机缺失(MCAR)**: 基本信息几乎无缺失，呈现随机性
- **非随机缺失(MNAR)**: 生化指标呈现系统性缺失，可能是由于部分受试者未进行相关检查
- **按检查类型分组缺失**: 同一检查类别的变量（如生化指标）缺失模式一致，表明数据收集过程中的系统性差异

## 3. 数据清洗流程详解

### 3.1 数据加载与检查
```python
找到最新数据文件: docs/excel/pwv数据采集表 -去公式.xlsx
正在加载数据文件: docs/excel/pwv数据采集表 -去公式.xlsx
成功加载数据: 222 行, 77 列
```

### 3.2 数据预处理步骤

#### 3.2.1 特殊值与格式处理
- **特殊字符替换**:
  - `cfPWV-颈动脉-SI` 和 `cfPWV-颈动脉-RI` 中的特殊值转换为NaN
  - `尿素（mmol/L）` 中的逗号替换为小数点
- **列名规范化**:
  - 删除重复的性别列 `性别`，保留 `受试者-性别`
  - 重命名主要列，提高可读性和一致性：
    ```
    '基础信息-年龄' → 'age'
    '受试者-性别' → 'gender' 
    '基础信息-身高' → 'height'
    '基础信息-体重' → 'weight'
    '竞品信息-脉搏波传导速度' → 'pwv'
    'cfPWV-速度m/s' → 'cfpwv_速度'
    'baPWV-右侧-速度m/s' → 'bapwv_右侧_速度'
    'baPWV-左侧-速度m/s' → 'bapwv_左侧_速度'
    ```

#### 3.2.2 数据类型转换
- **数值型转换**:
  ```
  列 'age' 转换为数值: 222 非空值 -> 222 非空值
  列 'height' 转换为数值: 222 非空值 -> 222 非空值
  列 'weight' 转换为数值: 222 非空值 -> 222 非空值
  列 'pwv' 转换为数值: 221 非空值 -> 221 非空值
  列 'cfpwv_速度' 转换为数值: 206 非空值 -> 206 非空值
  列 'bapwv_右侧_速度' 转换为数值: 213 非空值 -> 213 非空值
  列 'bapwv_左侧_速度' 转换为数值: 212 非空值 -> 212 非空值
  列 '收缩压' 转换为数值: 222 非空值 -> 222 非空值
  列 '舒张压' 转换为数值: 222 非空值 -> 222 非空值
  列 'cfPWV-颈动脉-SI ' 转换为数值: 222 非空值 -> 131 非空值
  列 'cfPWV-颈动脉-RI ' 转换为数值: 222 非空值 -> 129 非空值
  ```

#### 3.2.3 数据记录清理
- **删除关键缺失记录**:
  - 删除PWV值完全缺失的行，保留221行（数据保留率99.5%）

#### 3.2.4 缺失值填充策略
- **中位数填充**:
  ```
  列 'cfpwv_速度' 缺失值已用中位数 9.25 填充
  列 'bapwv_右侧_速度' 缺失值已用中位数 11.10 填充
  列 'bapwv_左侧_速度' 缺失值已用中位数 11.30 填充
  列 'cfPWV-颈动脉-SI ' 缺失值已用中位数 9.62 填充
  列 'cfPWV-颈动脉-RI ' 缺失值已用中位数 0.42 填充
  列 'cfPWV-颈动脉-DAIX ' 缺失值已用中位数 0.57 填充
  列 'cfPWV-时间间隔ms' 缺失值已用中位数 78.00 填充
  列 'cfPWV-距离cm' 缺失值已用中位数 72.00 填充
  列 'cfPWV-股动脉-SI ' 缺失值已用中位数 5.33 填充
  列 'cfPWV-股动脉-RI' 缺失值已用中位数 0.02 填充
  列 'cfPWV-股动脉-DAIX ' 缺失值已用中位数 0.99 填充
  列 'baPWV-右侧-距离cm' 缺失值已用中位数 110.00 填充
  列 'baPWV-右侧-时间间隔ms' 缺失值已用中位数 92.00 填充
  列 'baPWV-左侧-距离cm' 缺失值已用中位数 110.00 填充
  列 'baPWV-左侧-时间间隔ms' 缺失值已用中位数 90.00 填充
  ```
- **缺失值统计**:
  - 处理前缺失值: 4561个
  - 处理后缺失值: 3999个
  - 减少缺失率: 约12.3%

#### 3.2.5 异常值处理
- **极端值替换**:
  - `收缩压` 中的1个异常值替换为中位数 128.00
  - BMI异常值处理：未发现需替换的极端值

#### 3.2.6 数据编码与转换
- **性别标准化编码**:
  ```
  性别分布: 
  gender
  0    117  # 女性
  1    104  # 男性
  ```
- **衍生变量创建**:
  - 计算BMI：平均BMI值为24.84
  - 创建脉压差列
  - 删除全为NaN的列：`['其他']`

### 3.3 特征工程

#### 3.3.1 分类特征创建
- **年龄段特征**:
  ```
  已创建年龄段特征
  ```
- **血压分类特征**:
  ```
  已创建血压分类特征，分布: 
  bp_category
  正常血压     55
  1级高血压    54
  正常高值     50
  高值血压     47
  2级高血压     8
  低血压       4
  3级高血压     3
  ```
- **PWV分类特征**:
  ```
  已创建PWV分类特征，分布: 
  pwv_category
  偏高    98
  边缘    82
  正常    41
  ```

#### 3.3.2 风险评分特征
- **风险评分创建**:
  ```
  已创建总风险得分，平均值: 1.77
  已创建风险等级特征
  ```
- **PWV标记特征**:
  ```
  已添加cfPWV标记列
  已添加baPWV标记列
  ```

## 4. 数据清洗后质量评估

### 4.1 数据摘要
- **数据规模**: 221行 × 89列（含新增特征）
- **关键变量统计**:
  - 年龄(age)平均值: 58.67岁
  - BMI平均值: 24.84
  - PWV平均值: 9.50，中位数: 9.70
  - 性别差异: 女性PWV 9.54±1.88 vs 男性PWV 9.45±1.64

### 4.2 数据完整性评估
- **数据保留率**: 99.5%（222行→221行）
- **变量数增长率**: 15.6%（77列→89列）
- **缺失值减少率**: 12.3%（4561→3999个缺失数据点）

### 4.3 关键指标质量
- **PWV质量**: 完整度高，仅1个缺失值，无明显异常值
- **血压数据**: 完整度100%，1个异常值已修正
- **基础人口统计学数据**: 完整度100%，质量良好

### 4.4 仍存在的数据挑战
- **生化指标**: 约59%缺失率，可能导致基于此类数据的分析偏差
- **血管弹性参数**: 约40%缺失率，可能影响相关分析的可靠性
- **血流速度指标**: 约25%缺失率，需谨慎解释相关结果

## 5. 数据清洗经验与建议

### 5.1 缺失值处理策略评估
- **中位数填充**: 适用于本数据集的数值型变量，在保持数据分布特性的同时维持样本量
- **行删除**: 仅针对关键变量(PWV)完全缺失的记录，最小化数据损失
- **后续建议**: 
  - 对生化指标考虑多重插补(MI)方法提高估计准确性
  - 探索基于机器学习的缺失值预测方法

### 5.2 数据收集改进建议
- **标准化收集流程**: 减少血管弹性参数和血流速度指标的缺失
- **完整生化指标**: 确保更多受试者完成生化指标检测
- **异常值检查**: 在数据录入阶段增加实时异常值检查

### 5.3 数据质量保障措施
- **双重数据录入**: 减少手工录入错误
- **范围检查**: 实施自动化的数据范围检查，及时发现异常值
- **缺失值记录**: 明确记录缺失原因，区分"未检测"与"检测未成功"

## 6. 结论

原始PWV数据集整体质量良好，关键变量（年龄、性别、身高、体重、血压和PWV）的完整性高，为后续分析提供了可靠基础。主要数据质量问题集中在生化指标和部分血管参数的高缺失率。通过系统的数据清洗流程，成功保留了99.5%的样本记录，并通过中位数填充等方法处理了部分缺失值，同时创建了多个分类特征和风险评分特征，显著增强了数据集的分析价值。

尽管如此，在解释涉及高缺失率变量（如生化指标）的分析结果时，仍需保持谨慎，并考虑缺失数据可能带来的偏差。未来数据收集应加强生化指标和血管参数的完整性，以进一步提高数据质量。 